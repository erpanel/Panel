name: Run Windows with RDP

on: [push, pull_request]

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set up RDP
      run: |
        # Mengatur password untuk user default
        $password = "P@ssw0rd1234"
        net user actionsuser $password

        # Mengizinkan akses RDP
        Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server" -Name "fDenyTSConnections" -Value 0

        # Mengizinkan firewall rule untuk RDP
        Enable-NetFirewallRule -DisplayGroup "Remote Desktop"

        # Menampilkan informasi RDP
        $vmName = (Get-WmiObject -Class Win32_ComputerSystem).Name
        $ipAddress = (Get-NetIPAddress -AddressFamily IPv4 | Where-Object { $_.InterfaceAlias -eq "Ethernet" }).IPAddress
        Write-Output "RDP Information"
        Write-Output "VM Name: $vmName"
        Write-Output "IP Address: $ipAddress"
        Write-Output "Username: actionsuser"
        Write-Output "Password: $password"
      shell: pwsh

    - name: Wait for RDP connection
      run: |
        Write-Output "Waiting for RDP connection. You can now connect using the above information."
        Start-Sleep -Seconds 3600
      shell: pwsh
